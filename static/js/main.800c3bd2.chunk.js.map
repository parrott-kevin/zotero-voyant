{"version":3,"sources":["components/input/viewModel.ts","components/input/index.tsx","App.tsx","index.tsx"],"names":["InputViewModel","file","this","readUploadedFileAsText","fileContents","process","processed","encoded","encodeURIComponent","JSON","stringify","data","result","Error","console","error","message","inputFile","reader","FileReader","Promise","resolve","reject","onerror","abort","DOMException","onload","readAsText","value","parseStringPromise","xmlParsed","parse","corpus","xml","records","record","forEach","title","titles","reduce","item","concat","join","content","keywords","words","keyword","push","sanitize","replace","notes","sanitized","style","styleContents","i","_","HiddenInput","styled","display","Input","useState","setData","inputEl","useRef","vm","viewModel","handleUpload","event","a","target","files","Grid","container","direction","spacing","xs","sm","Button","variant","color","href","download","fullWidth","type","onClick","ref","id","onChange","e","current","click","App","AppBar","position","Toolbar","Box","mr","Typography","mt","Container","component","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.800c3bd2.chunk.js","sourcesContent":["import { parseStringPromise } from 'xml2js';\n\ninterface Record {\n  titles: Title[];\n  keywords?: Keyword[];\n  'research-notes'?: (string | Style)[];\n}\n\ninterface Title {\n  title: string[];\n}\n\ninterface Keyword {\n  keyword: string[];\n}\n\ninterface Style {\n  style: { _: string }[];\n}\n\n// https://voyant-tools.org/docs/#!/guide/corpuscreator-section-json\ninterface Corpus {\n  title: string;\n  content: string;\n  author?: string;\n  publicationDate?: string;\n  publisher?: string;\n  location?: string;\n  // keywords?: string;\n  collection?: string;\n}\n\nexport default class InputViewModel {\n  async handleUpload(file: File): Promise<string | undefined> {\n    try {\n      const fileContents = await this.readUploadedFileAsText(file);\n      if (typeof fileContents === 'string') {\n        const processed = await this.process(fileContents);\n        const encoded = encodeURIComponent(JSON.stringify({ data: processed }));\n        const result = `data:application/json;charset=utf-8,${encoded}`;\n        return result;\n      } else {\n        throw new Error('Problem parsing input file');\n      }\n    } catch (err) {\n      console.error(err.message);\n      return;\n    }\n  }\n\n  async readUploadedFileAsText(\n    inputFile: Blob\n  ): Promise<string | ArrayBuffer | null> {\n    const reader = new FileReader();\n    return new Promise((resolve, reject) => {\n      reader.onerror = (): void => {\n        reader.abort();\n        reject(new DOMException('Problem parsing input file'));\n      };\n\n      reader.onload = (): void => {\n        resolve(reader.result);\n      };\n      reader.readAsText(inputFile, 'UTF-8');\n    });\n  }\n\n  async process(value: string): Promise<Corpus[]> {\n    const xmlParsed = await parseStringPromise(value);\n    const result = JSON.parse(JSON.stringify(xmlParsed));\n\n    const corpus: Corpus[] = [];\n    result.xml.records[0].record.forEach((record: Record) => {\n      const title = record.titles.reduce((result: string, item) => {\n        return result.concat(item.title.join(' '), ' ');\n      }, '');\n\n      const content = [];\n      if (record.keywords) {\n        const words = record.keywords.reduce((result: string, item) => {\n          return result.concat(item.keyword.join(' '), ' ');\n        }, '');\n        content.push(words);\n      }\n\n      if (record['research-notes']) {\n        const sanitize = (item: string): string =>\n          item.replace(/\\r?\\n|\\r/g, ' ');\n\n        const notes = record['research-notes'].reduce(\n          (result: string, item) => {\n            if (typeof item === 'string') {\n              const sanitized = sanitize(item);\n              return result.concat(sanitized, ' ');\n            } else if (item.style) {\n              const styleContents = item.style.reduce((result: string, i) => {\n                if (i._) {\n                  const sanitized = sanitize(i._);\n                  return result.concat(sanitized, ' ');\n                } else {\n                  return result;\n                }\n              }, '');\n              return result.concat(styleContents, ' ');\n            } else {\n              return result;\n            }\n          },\n          ''\n        );\n        content.push(notes);\n      }\n\n      corpus.push({\n        title,\n        content: content.join(' '),\n      });\n    });\n\n    return corpus;\n  }\n}\n","import Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport { styled } from '@material-ui/core/styles';\nimport React, { useRef, useState } from 'react';\n\nimport viewModel from './viewModel';\n\nconst HiddenInput = styled('input')({\n  display: 'none',\n});\n\nconst Input: React.FC = () => {\n  const [data, setData] = useState('');\n  const inputEl = useRef<HTMLInputElement | null>(null);\n\n  const vm = new viewModel();\n\n  const handleClick = (): void => {\n    inputEl.current?.click();\n  };\n\n  const handleUpload = async (\n    event: React.ChangeEvent<HTMLInputElement>\n  ): Promise<void> => {\n    if (event.target.files) {\n      const file = event.target.files[0];\n      const result = await vm.handleUpload(file);\n      if (result) {\n        setData(result);\n      }\n    }\n  };\n\n  const handleReset = (): void => {\n    setData('');\n  };\n\n  return (\n    <Grid container direction=\"column\" spacing={2}>\n      {!data ? (\n        <Grid item xs={12} sm={6}>\n          <HiddenInput\n            ref={inputEl}\n            type=\"file\"\n            id=\"upload\"\n            onChange={(e): void => {\n              handleUpload(e);\n            }}\n          />\n          <Button\n            variant=\"outlined\"\n            color=\"primary\"\n            onClick={handleClick}\n            fullWidth\n          >\n            Upload XML file\n          </Button>\n        </Grid>\n      ) : (\n        <>\n          <Grid item xs={12} sm={6}>\n            <Button\n              variant=\"contained\"\n              color=\"primary\"\n              href={data}\n              download=\"data.json\"\n              fullWidth\n            >\n              Download\n            </Button>\n          </Grid>\n          <Grid item xs={12} sm={6}>\n            <Button\n              variant=\"outlined\"\n              color=\"secondary\"\n              type=\"button\"\n              onClick={handleReset}\n              fullWidth\n            >\n              Reset\n            </Button>\n          </Grid>\n        </>\n      )}\n    </Grid>\n  );\n};\nexport default Input;\n","import AppBar from '@material-ui/core/AppBar';\nimport Box from '@material-ui/core/Box';\nimport Container from '@material-ui/core/Container';\nimport Grid from '@material-ui/core/Grid';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Typography from '@material-ui/core/Typography';\nimport TransformIcon from '@material-ui/icons/Transform';\nimport React from 'react';\n\nimport Input from './components/input';\n\nconst App: React.FC = () => {\n  return (\n    <>\n      <AppBar position=\"static\">\n        <Toolbar>\n          <Box mr={1}>\n            <TransformIcon />\n          </Box>\n          <Typography variant=\"h6\">ZoVo</Typography>\n        </Toolbar>\n      </AppBar>\n      <Box mt={1}>\n        <Container>\n          <Grid container>\n            <Grid item xs={12} sm={6}>\n              <Typography variant=\"h6\">Create Corpus</Typography>\n              <Typography variant=\"body1\" component=\"span\">\n                <ol>\n                  <li>Click Upload XML File</li>\n                  <li>Select XML File from Computer</li>\n                  <li>Click Download JSON corpus</li>\n                </ol>\n              </Typography>\n              <Typography variant=\"h6\">\n                Uploading JSON corpus to Voyant\n              </Typography>\n              <Typography variant=\"body1\" component=\"span\">\n                <ol>\n                  <li>Click the Options slide</li>\n                  <li>Click JSON to open relevant fields</li>\n                  <li>\n                    Fill in fields with following information\n                    <ul>\n                      <li>Content: /content</li>\n                      <li>Title: /title</li>\n                      <li>Author: leave blank</li>\n                      <li>Documents: /data</li>\n                    </ul>\n                  </li>\n                  <li>Click Upload</li>\n                  <li>Select JSON corpus saved from ZoVo</li>\n                </ol>\n              </Typography>\n            </Grid>\n            <Grid item xs={12} sm={6}>\n              <Input />\n            </Grid>\n          </Grid>\n        </Container>\n      </Box>\n    </>\n  );\n};\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}